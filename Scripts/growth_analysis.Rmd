---
title: "growth_analysis"
author: "Denver Link"
date: "2025-06-23"
output: html_document
editor_options: 
  chunk_output_type: console
---

# Packages
```{r}
library(tidyverse)
library(arrow)
library(ggplot2)
library(dplyr)
library(sf)
library(ggspatial)
library(ggthemes)
library(rnaturalearth)
library(rnaturalearthdata)
```

# Data
-growth data from MN
-zm and ssw lakes from mn infested waters list
```{r}
mn_data <- open_dataset(sources = file.path("G:",
                                            "Shared drives",
                                            "Hansen Lab",
                                            "RESEARCH PROJECTS",
                                            "Fish Survey Data",
                                            "manuscript_products",
                                            "ScienceBase",
                                            "midwest_hive"),
                        partitioning = "state") %>% 
  filter(state == "Minnesota" & !is.na(est_age))

zm_ssw <- read_csv(file.path("D:",
                             "Shared drives",
                             "Hansen Lab",
                             "RESEARCH PROJECTS",
                             "Statewide mercury modeling",
                             "Data",
                             "Covariate Data",
                             "zm_ssw_6jan2026.csv")) %>% 
  #filter out na dows or those "none"
  filter(!is.na(dow) & !(str_detect(dow, "n"))) %>% 
  #generate original id for reference
  mutate(original_id = dow) %>% 
  #remove dashes
  #make sure short dows are 8 digits
  #fix a few manually
  #remove leading 0s to match the fish data
  mutate(dow = str_replace_all(dow, pattern = "-", ""),
         dow = if_else(nchar(dow) == 6, paste0(dow, "00"), dow),
         dow = case_when(dow == "10179" ~ "01017900",
                         str_detect(dow, "040063") ~ "04006300",
                         TRUE ~ dow),
         dow = case_when(str_starts(dow, "0") ~ str_sub(dow, 2),
                         TRUE ~ dow))  %>% 
  #rename dow to match fishereis column
  rename(lake_id = dow) %>% 
  #pivot to lake per row, with zm and starry columns 
  pivot_wider(id_cols = c(lake_id, lake_name),
              names_from = ais,
              values_from = year_infested,
              values_fn = min) %>% 
  rename(zm = `zebra mussel`,
         ssw = `starry stonewort`)

#crosswalk - get lat and lon from fish data
xwalk <- open_dataset(sources = file.path("D:",
                                          "Shared drives", 
                                          "Hansen Lab", 
                                          "RESEARCH PROJECTS",
                                          "Fish Survey Data",
                                          "Parquet files",
                                          "hive_update"),
                      partitioning = c("state")) %>% 
  filter(state == "Minnesota") %>% 
  filter(!is.na(latitude_lake_centroid) & !is.na(lake_id)) %>% 
  distinct(lake_id, latitude_lake_centroid, longitude_lake_centroid) %>% 
  collect() 
```

# Exploring growth data
```{r}
#how many lakes do we have for each species at the year level?
mn_data %>% 
  filter(alk == "year") %>% 
  group_by(species_1) %>% 
  summarise(n_lakes = n_distinct(lake_id)) %>% 
  collect()

#how many lakes with lake-year data do we have for each invasive?
mn_data %>% 
  filter(alk == "year") %>% 
  left_join(zm_ssw, by = "lake_id") %>% 
  group_by(lake_id) %>% 
  mutate(ais = case_when(!is.na(zm) & is.na(ssw) ~ "zm",
                         !is.na(ssw) & is.na(zm) ~ "ssw",
                         !is.na(ssw) & !is.na(zm) ~ "both",
                         is.na(ssw) & is.na(zm) ~ "none")) %>% 
  ungroup() %>% 
  distinct(lake_id, ais) %>% 
  group_by(ais) %>% 
  count() %>% 
  collect()

#what is the general sense for species?
check <- mn_data %>% 
  filter(alk == "year") %>% 
  left_join(zm_ssw, by = "lake_id") %>% 
  group_by(lake_id, species_1) %>% 
  mutate(ais = case_when(!is.na(zm) & is.na(ssw) ~ "zm",
                         !is.na(ssw) & is.na(zm) ~ "ssw",
                         !is.na(ssw) & !is.na(zm) ~ "both",
                         is.na(ssw) & is.na(zm) ~ "none"),
         impact_zm = case_when(year >= zm ~ "before",
                               year < zm ~ "after",
                               TRUE ~ "NA"),
         impact_ssw = case_when(year >= ssw ~ "before",
                                year < ssw ~ "after",
                                TRUE ~ "NA")) %>% 
  ungroup() %>% 
  distinct(lake_id, ais, species_1, impact_zm, impact_ssw) %>% 
  collect()
#we can see here if we have before and after for each invasive - NA for where it is uninvaded for that species
glimpse(check)

#general on fish we have growth data
invasion_summary <- check %>%
  group_by(lake_id, species_1) %>%
  summarise(
    zm_before = any(impact_zm == "before"),
    zm_after  = any(impact_zm == "after"),
    ssw_before = any(impact_ssw == "before"),
    ssw_after  = any(impact_ssw == "after"),
    .groups = "drop"
  ) %>%
  mutate(
    zm_status = case_when(
      zm_before & zm_after ~ "both",
      zm_before & !zm_after ~ "before only",
      !zm_before & zm_after ~ "after only",
      !zm_before & !zm_after ~ "neither"
    ),
    ssw_status = case_when(
      ssw_before & ssw_after ~ "both",
      ssw_before & !ssw_after ~ "before only",
      !ssw_before & ssw_after ~ "after only",
      !ssw_before & !ssw_after ~ "neither"
    )
  )

invasion_counts <- invasion_summary %>%
  group_by(species_1) %>% 
  count(zm_status, ssw_status) %>% 
  pivot_longer(cols = c(zm_status, ssw_status),names_to = "ais",values_to = "timing") %>% 
  group_by(species_1, ais, timing) %>% 
  summarise(n = sum(n))

invasion_counts %>% 
  filter(timing != "neither") %>% 
  ggplot() +
  geom_col(aes(timing, n)) +
  facet_grid(species_1~ais)

invasion_counts %>% 
  filter(timing != "neither") %>% 
  #filter(ais == "zm_status") %>% 
  ggplot() +
  geom_col(aes(timing, n)) +
  facet_grid(ais~species_1)

#how many sssw lakes do we have pre and post?
invasion_counts %>% 
  filter(ais == "ssw_status" & timing == "both")

ssw_lakes <- check %>% 
  filter(ais %in% c("ssw", "both")) %>% 
  select(-impact_zm, -ais) %>% 
  distinct(lake_id, species_1, impact_ssw) %>% 
  mutate(indicator = 1) %>% 
  pivot_wider(names_from = impact_ssw,
              values_from = indicator)
glimpse(ssw_lakes)

ssw_lakes_both <- ssw_lakes %>% 
  filter(before == "1" & after == "1") %>% 
  select(-after, -before) %>% 
  group_by(lake_id) %>% 
  summarise(species_1 = list(species_1), .groups = "drop") %>% 
  mutate(species_1 = sapply(species_1, toString))
  

###years of data?
years <- mn_data %>% 
  filter(alk == "year") %>% 
  left_join(zm_ssw, by = "lake_id") %>% 
  group_by(lake_id, species_1, year) %>% 
  mutate(ais = case_when(!is.na(zm) & is.na(ssw) ~ "Zebra Mussel",
                         !is.na(ssw) & is.na(zm) ~ "Starry Stonewort",
                         !is.na(ssw) & !is.na(zm) ~ "ZM and SSW",
                         is.na(ssw) & is.na(zm) ~ "Uninvaded")) %>% 
  distinct(lake_id, ais, species_1, year) %>% 
  collect()

years %>% 
  group_by(species_1, lake_id, ais) %>% 
  count() %>% 
  ggplot() +
  geom_histogram(aes(n)) +
  labs(x = "# of years with halk at lake-year level",
       y = "# of lakes") +
  facet_grid(species_1~ais, scales = "free")
```

# Map 
```{r}
lake_species <- mn_data %>% 
  filter(alk == "year") %>% 
  left_join(zm_ssw, by = "lake_id") %>% 
  select(-ssw) %>% 
  group_by(lake_id, species_1) %>% 
  mutate(ais = case_when(!is.na(zm) ~ "zm",
                         is.na(zm) ~ "uninvaded"),
         impact_zm = case_when(year >= zm ~ "before",
                               year < zm ~ "after",
                               TRUE ~ "NA")) %>% 
  ungroup() %>% 
  distinct(lake_id, ais, species_1, impact_zm) %>% 
  collect() %>% 
  pivot_wider(id_cols = c(lake_id, species_1, ais), values_from = impact_zm,names_from = impact_zm) %>% 
  #zm_ssw has two a record for both zm and ssw for these lakes - leading an erroneous uninvaded row
  filter(!(lake_id == "18031100" & ais == "uninvaded") &
           !(lake_id == "4007900" & ais == "uninvaded")) %>% 
  mutate(timing = case_when(ais == "uninvaded" ~ "y",
                            ais == "zm" & !is.na(after) & !is.na(before) ~ "y",
                            TRUE ~ "n")) %>% 
  filter(timing == "y")

#we now attach spatial data, remove where they are na because they are mostly river or small
lake_species <- lake_species %>% 
  left_join(xwalk) %>% 
  filter(!is.na(latitude_lake_centroid)) %>% 
  select(lake_id, species_1, ais, latitude_lake_centroid, longitude_lake_centroid)

lake_sf <- lake_species %>%
  distinct(lake_id, species_1, ais, latitude_lake_centroid, longitude_lake_centroid) %>%
  st_as_sf(coords = c("longitude_lake_centroid", "latitude_lake_centroid"), crs = 4326)

us_states <- ne_states(country = "United States of America", returnclass = "sf")
mn_border <- us_states %>% filter(name == "Minnesota")

# Plot
lake_uninvaded <- lake_sf %>% filter(ais == "uninvaded")
lake_zm <- lake_sf %>% filter(ais == "zm")

ggplot() +
  geom_sf(data = mn_border, fill = NA, color = "black") +
  geom_sf(data = lake_uninvaded, color = "lightblue", alpha = 0.6, size = 2) +
  geom_sf(data = lake_zm, color = "salmon", alpha = 0.9, size = 2.5) +
  facet_wrap(~ species_1) +
  theme_minimal() +
  labs(color = "Invasion") +
  coord_sf(xlim = st_bbox(mn_border)[c("xmin", "xmax")],
           ylim = st_bbox(mn_border)[c("ymin", "ymax")])

#subset
lake_species_sub <- lake_species %>% 
  left_join(xwalk) %>% 
  filter(!is.na(latitude_lake_centroid)) %>% 
  select(lake_id, species_1, ais, latitude_lake_centroid, longitude_lake_centroid) %>% 
  filter(species_1 %in% c("walleye", "northern_pike", "bluegill")) %>% 
  mutate(species_clean = case_when(species_1 == "walleye" ~ "Walleye",
                                   species_1 == "northern_pike" ~ "Northern Pike",
                                   species_1 == "bluegill" ~ "Bluegill"))

lake_sf <- lake_species_sub %>%
  distinct(lake_id, species_clean, ais, latitude_lake_centroid, longitude_lake_centroid) %>%
  st_as_sf(coords = c("longitude_lake_centroid", "latitude_lake_centroid"), crs = 4326)

lake_uninvaded <- lake_sf %>% filter(ais == "uninvaded")
lake_zm <- lake_sf %>% filter(ais == "zm")

ggplot() +
  geom_sf(data = mn_border, fill = NA, color = "black") +
  geom_sf(data = lake_uninvaded, color = "lightblue", alpha = 0.6, size = 1.5) +
  geom_sf(data = lake_zm, color = "salmon", alpha = 0.9, size = 2) +
  facet_wrap(~ species_clean) +
  theme_minimal() +
  theme(panel.grid = element_blank(),
        strip.text = element_text(size = 12)) +
  labs(color = "Invasion") +
  coord_sf(xlim = st_bbox(mn_border)[c("xmin", "xmax")],
           ylim = st_bbox(mn_border)[c("ymin", "ymax")])
```

# Pulling in the raw data
```{r}
age_data <- mn_data %>% 
  filter(alk == "year") %>% 
  right_join(lake_species_sub, by = c("lake_id", "species_1"), suffix = c("_fish", "_invasion")) %>% 
  collect() %>% 
  select(lake_id,
         nhdhr_id,
         date_total_effort_ident,
         date_sample,
         year,
         sampling_method,
         site_id,
         species_1,
         length_1,
         length_unit_1,
         age,
         aging_structure_1,
         est_age,
         alk,
         alk_age_str,
         alk_length,
         alk_n,
         weight_1,
         weight_unit_1,
         flag,
         notes_1) %>% 
  left_join(zm_ssw, by = "lake_id") %>% 
  mutate(impact_zm = case_when(year >= zm ~ "before",
                               year < zm ~ "after",
                               TRUE ~ NA),
         impact_ssw = case_when(year >= ssw ~ "before",
                                year < ssw ~ "after",
                                TRUE ~ NA),
         ais = case_when(!is.na(zm) & is.na(ssw) ~ "zm",
                         !is.na(ssw) & is.na(zm) ~ "ssw",
                         !is.na(ssw) & !is.na(zm) ~ "both",
                         is.na(ssw) & is.na(zm) ~ "none")) 
glimpse(age_data)

age_data  %>% 
  group_by(ais) %>% 
  summarise(n_distinct(lake_id))
```

# 2025 continuation lake selection exploration 
1. Count of lakes across the state with zm, ssw, or both?
2. Prior hg data?
3. Do we know anything about its abundance?
*note that some dows may be better to be a parent dow (bemidji has 00 ending in infested waters but 01 or 02 for hg*
```{r}
# lakes listed as infested with zebra mussels or starry through 2025
#this file was generated by
# 1. downloading the most recent DNR infested waters list
# 2. filtering species for zebra mussel and starry
# 3. copy and past into another excel and saving as csv
zm_ssw <- read_csv("Data/zm_ssw_6jan2026.csv") %>% 
  filter(!is.na(dow)) %>% 
  filter(!(dow %in% c("na", "none"))) %>% 
  distinct() %>% 
  mutate(dow = case_when(str_detect(dow, "04-0063") ~ "04-0063",
                         TRUE ~ dow))

#mercury data
hg <- read_csv("Data/allfish_data_04042024_JLO.csv") 


########################clean data #############################################
#fix invasion data
clean_lake_ids <- function(id) {
  if (is.na(id) || id == "") return(NA_character_)  # Handle NA or empty values
  
  id_clean <- as.character(id)  # Ensure it's a character string
  id_clean <- str_replace_all(id_clean, "-", "")  # Remove dashes
  
  # Ensure it has a leading zero if it originally had one
  if (nchar(id_clean) < 6) {
    id_clean <- str_pad(id_clean, width = 6, pad = "0", side = "left")
  }
  
  # Ensure it's 8 digits long
  if (nchar(id_clean) == 6) {
    id_clean <- paste0(id_clean, "00")  # Append "00" if only 6 digits long
  }
  
  return(id_clean)
}

#apply cleaning to data
zm_ssw <- zm_ssw %>% 
  mutate(dow = sapply(dow, clean_lake_ids))
rm(clean_lake_ids)

#pivot so we have one lake per row, two columns for invasive species (one for zm and one for starry)
zm_ssw <- zm_ssw %>% 
  select(dow, ais, year_infested) %>% 
  pivot_wider(names_from = ais,
              values_from = year_infested) %>% 
  rename(zm_year_infested = `zebra mussel`,
         ssw_year_infested = `starry stonewort`)

#clean hg data now
clean_dowid <- function(id) {
  if (is.na(id) || id == "") return(NA_character_)  # Handle NA values
  id_clean <- str_replace_all(id, "-", "")  # Remove dashes
  return(id_clean)
}

hg <- hg %>% 
  mutate(dow = map_chr(DOWID, clean_dowid))
rm(clean_dowid)

# looking at lakes across the state with zm and ssw
############### across state exploration ################################
zm_ssw_lakes <- zm_ssw %>% 
  filter(!is.na(dow)) %>% 
  filter(!(str_detect(dow, "none")))

zm_ssw_lakes %>% 
  summarise(zm_only = sum(!is.na(zm_year_infested) & is.na(ssw_year_infested)),
            ssw_only = sum(is.na(zm_year_infested) & !is.na(ssw_year_infested)),
            zm_and_ssw = sum(!is.na(zm_year_infested) & !is.na(ssw_year_infested)))

#only starry lakes
zm_ssw_lakes %>% 
  left_join(hg %>% 
              distinct(dow, WATERWAY), by = "dow") %>% 
  filter(is.na(zm_year_infested) & !is.na(ssw_year_infested))
# upper red, wolf, and rush DO have zm but they list zm with a different dow in list
# for example Upper red is listed wtih 04003500 for zm but 04003501 for ssw
# north twin (04006300) does not have starry listed on lake finder
# Bowen shows both zm and starry on lake finder

# both
zm_ssw_lakes %>% 
  left_join(hg %>% 
              distinct(dow, WATERWAY), by = "dow") %>% 
  filter(!is.na(zm_year_infested) & !is.na(ssw_year_infested)) %>% 
  print(n = nrow(.))

###############lets look at the lakes we studied prior######################
# there are several lakes we probably want to further explore the dow relationship to spatial resolution (or maybe consider parent dow)

hg %>% 
  filter(str_detect(WATERWAY, "KORONIS|LIDA|CASS|WINNIBIGOSH|BEMIDJI")) %>% 
  distinct(WATERWAY, dow) %>% 
  arrange(dow)

zm_ssw %>% 
  filter(str_detect(dow, "560747|73020|040130")) %>% 
  arrange(dow)
#okay we can see here this is going to be a PIA trying to link hg and invasion data becuase the invasion data is often at a more general dos resolution than the mercury; koronis is 02 for mercury but takes the 00 in the invasion data
#we also see this from Bemidji, invasion data has 00 and the hg data has 02

#create a parent dow to link 
hg <- hg %>% 
  mutate(parent_dow = substr(dow, 1, 6))

zm_ssw_lakes <- zm_ssw_lakes %>% 
  mutate(parent_dow = substr(dow, 1, 6))


study_dows <- read_csv("Data/foodweb_lakes.csv") %>% 
  mutate(dow = as.character(dow),
         dow = str_pad(dow, width = 8, side = "left", pad = "0")) %>% 
  mutate(parent_dow = substr(dow, 1, 6))

#join study lakes to invasion data
study_comb <- study_dows %>% 
  left_join(zm_ssw_lakes, by = "parent_dow", suffix = c("_umn", "_invasion"))

#join study lake info to mercury data
study_hg <- hg %>% 
  right_join(study_comb, by = "parent_dow", suffix = c("_hg", "_umn"))

# summary of hg data from the state for our study lakes
study_hg %>% 
  group_by(dow, WATERWAY, SPEC) %>%
  summarise(n_hg = sum(!is.na(HGPPM))) %>% 
  pivot_wider(id_cols = c("dow", "WATERWAY",),names_from = SPEC,values_from = n_hg) %>% 
  select(NOP, WAE, BLC, BLG, YEP, WTS, SMB, LMB) %>% 
  print(n = nrow(.))

study_comb %>% 
  left_join(hg %>% 
              select(parent_dow, WATERWAY), by = "parent_dow") %>% 
  mutate(invasion = case_when(!is.na(zm_year_infested) & is.na(ssw_year_infested) ~ "zm_only",
                              is.na(zm_year_infested) & !is.na(ssw_year_infested) ~ "ssw_only",
                              TRUE ~ "both")) %>% 
  distinct(dow_umn, WATERWAY, invasion) %>% 
  arrange(invasion) %>% 
  print(n = nrow(.))

#how many samples pre/post invasion?
#first zm
study_hg %>% 
  filter(!is.na(zm_year_infested)) %>%
  filter(SPEC %in% c("NOP", "WAE")) %>% 
  group_by(dow, WATERWAY, SPEC, zm_year_infested) %>%
  summarise(n_hg_pre = sum(YEARCOLL < zm_year_infested),
            n_hg_post = sum(YEARCOLL >= zm_year_infested)) %>% 
  pivot_wider(id_cols = c("dow", "WATERWAY", "zm_year_infested"),names_from = SPEC,values_from = c("n_hg_pre", "n_hg_post")) %>% 
  relocate(n_hg_post_NOP, .after = n_hg_pre_NOP) %>% 
  print(n = nrow(.)) 

#now ssw
study_hg %>% 
  filter(!is.na(ssw_year_infested)) %>%
  filter(SPEC %in% c("NOP", "WAE")) %>% 
  group_by(dow, WATERWAY, SPEC, ssw_year_infested) %>%
  summarise(n_hg_pre = sum(YEARCOLL < ssw_year_infested),
            n_hg_post = sum(YEARCOLL >= ssw_year_infested)) %>% 
  pivot_wider(id_cols = c("dow", "WATERWAY", "ssw_year_infested"),names_from = SPEC,values_from = c("n_hg_pre", "n_hg_post")) %>% 
  relocate(n_hg_post_NOP, .after = n_hg_pre_NOP) %>% 
  print(n = nrow(.)) 

# Big Cormorant? - quite a few samples but spread across species 
study_hg %>% 
  filter(dow %in% c("03057600", "11014700", "34007900", "86025200")) %>% 
  filter(SPEC %in% c("WAE", "NOP")) %>% 
  mutate(zm = case_when(YEARCOLL < zm_year_infested ~ "pre",
                        YEARCOLL >= zm_year_infested ~ "post")) %>% 
  ggplot() +
  geom_point(aes(LGTHIN, log(HGPPM), color = zm)) +
  geom_smooth(aes(LGTHIN, log(HGPPM), color = zm), method = "lm") +
  facet_grid(WATERWAY~SPEC)


###############combine invasion and hg data####################################
#lets look for lakes that have multiple dows within a parent down in the invasion data
zm_ssw_lakes %>% 
  group_by(parent_dow) %>% 
  filter(n_distinct(dow) > 1) %>% 
  select(dow, parent_dow) %>% 
  arrange(dow) %>% 
  print(n = nrow(.))
#if joining on the parent dow, these will create an issue with a many to many join
#since the invasion data is at a better resolution than it typically is, lets filter these out of the parent dow join and then do a second join on just dow

#filter for lakes that only have on parent dow for easy joining
parent_dow_join <- zm_ssw_lakes %>% 
  group_by(parent_dow) %>% 
  filter(n_distinct(dow) == 1)

#join to hg data - we keep both dows for invasion and hg (so we can look dow specific hg)
first <- parent_dow_join %>% 
  left_join(hg, by = "parent_dow", suffix = c("_invasion", "_hg"))

#now lets gather the misfits and join by dow
dow_join <- zm_ssw_lakes %>% 
  group_by(parent_dow) %>% 
  filter(n_distinct(dow) > 1)

additional <- dow_join %>% 
  left_join(hg, by = "dow", suffix = c("_invasion", "_hg")) 

glimpse(additional)
#we join on dow so we get the common dow, but we will want to make sure it fill both dow_hg and dow_invasion to match the above dataframe
#we also only want one parent dow (they would both be the same anyway)
additional <- additional %>% 
  mutate(dow_hg = dow,
         dow_invasion = dow,
         parent_dow = parent_dow_invasion) %>% 
  select(-dow,
         -parent_dow_invasion,
         -parent_dow_hg)

#join both together
zm_ssw_hg <- bind_rows(first, additional) 
#remove unnessary dataframes
rm(parent_dow_join, first, dow_join, additional)

#quick summary of ais lakes with mercury data
ais_lakes <- zm_ssw_hg %>% 
  distinct(parent_dow, WATERWAY, YEARCOLL, SPEC, zm_year_infested, ssw_year_infested) %>% 
  mutate(pre_ssw = case_when(YEARCOLL < ssw_year_infested ~ "y",
                             TRUE ~ "n"),
         post_ssw = case_when(YEARCOLL > ssw_year_infested ~ "y",
                             TRUE ~ "n"),
         pre_zm = case_when(YEARCOLL < zm_year_infested ~ "y",
                             TRUE ~ "n"),
         post_zm = case_when(YEARCOLL > zm_year_infested ~ "y",
                             TRUE ~ "n"))
#write_csv(ais_lakes, "dnr_hg_invasion.csv")

#how many for wae and nop?
ais_lakes_n <- zm_ssw_hg %>% 
  select(dow_hg, WATERWAY, YEARCOLL, SPEC, zm_year_infested, ssw_year_infested) %>% 
  filter(SPEC %in% c("WAE", "NOP")) %>% 
  group_by(dow_hg, WATERWAY, SPEC) %>% 
  summarise(pre_ssw = sum(YEARCOLL < ssw_year_infested),
         post_ssw = sum(YEARCOLL > ssw_year_infested),
         pre_zm = sum(YEARCOLL < zm_year_infested),
         post_zm = sum(YEARCOLL > zm_year_infested)) %>% 
  pivot_wider(id_cols = c("dow_hg", "WATERWAY"),names_from = "SPEC",values_from = c("pre_ssw", "post_ssw", "pre_zm", "post_zm")) %>% 
  select(dow_hg,
         WATERWAY,
         pre_ssw_NOP,
         post_ssw_NOP,
         pre_ssw_WAE,
         post_ssw_WAE,
         pre_zm_NOP,
         post_zm_NOP,
         everything())

```
